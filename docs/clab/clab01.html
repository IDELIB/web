<html>
<head>
<title>CLab_01-開発環境</title>
</head>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<CENTER>
<TABLE BORDER=0 WIDTH="600" BGCOLOR="#FEFBDA">
<TR><TD>

<TABLE BORDER=0" WIDTH="600">
<TR>
<TD BGCOLOR="#800040" WIDTH="10%" ALIGN="CENTER">
<FONT SIZE=2 COLOR="#FFFFFF"><B>第１章</B></FONT>
</TD>

<TD BGCOLOR="000000" WIDTH="75%">
<FONT SIZE=4 COLOR ="#FFFFFF"><B>　開発環境について</B></FONT>
<BR>
</TD>
<TD BGCOLOR="000000" WIDTH="15%">
<FONT SIZE=1 COLOR ="#FFFFFF"><B>
RPGプログラマーの為のＣ言語講座
</B></FONT>
</TD>
</TR>
</TABLE>
</TD></TR>

<TR><TD ALIGN="CENTER">
<TABLE BORDER=0 WIDTH="570">
<TR>
<TD><FONT SIZE=2>

<P>　<FONT SIZE=+1 COLOR="#008000"><B>実際のプログラミングの解説に入る前に、ＡＳ／４００上でＣ言語のプログラムを開発するには、どのような環境が必要になるのかを説明したいと思います。</B></FONT>

<P>プログラムを作成するには、まずソースコードをＡＳ／４００のソースファイルに登録する必要があります。

<P><B>Ｃ言語では、英小文字と英大文字は明確に区別されます。</B>
<P>したがって、英小文字をソースファイルに登録出来ることが必要になります。
<P>ここで注意が必要なのは、ＡＳ／４００の日本語環境（言語コード２９６２）では、省略時の文字に英小文字が含まれていないことです。ＡＳ／４００は文字コードとしてEBCDICを使用していますが、日本語のEBCDICでは、長い間英小文字のコードにカタカナ文字を割り当てて使用してきました。その為、日本語のEBCDICでは、英小文字とカタカナを同時に使用することが出来ませんでした。最近は、英小文字とカタカナ文字の両方が使えるコード表（5035）が使用出来るようになったのは比較的最近のことです。日本語のＯＳ／４００を使用する場合はこのコード（5035）にJOBのCCSIDを設定することが必要です。

<P><B>次に、Ｃ言語では、いくつかの特殊文字がコーディング上必要になります。</B>

<P>特に / [ ] \ { } 〜 ¬　| などの文字は、注意が必要です。キーボードから打鍵したい場合に、キーボートに文字が割り当てられれていないと、入力することができません。鍵盤タイプによっては、キーが用意されていないので、打鍵することができないことがあります。

<P>必要とする文字セットの違い

<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=5 BGCOLOR="#80FF80" >
<TR>
<TD>　</TD>
<TD><B>ＲＰＧ言語</B></TD>
<TD><B>Ｃ言語</B></TD>
</TR>

<TR>
<TD>
文字
</TD>
<TD>
<P>A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
</TD>
<TD>
<P>a b c d e f g h i j k l m n o p q r s t u v w x y z<BR>
A B C D E F G H I J K L M N O P Q R S T U V W X Y Z
</TD>
</TR>

<TR>
<TD>数字</TD>
<TD> 0 1 2 3 4 5 6 7 8 9</TD>
<TD> 0 1 2 3 4 5 6 7 8 9</TD>
</TR>
<TR>
<TD>特殊文字</TD>
<TD> + - * , . ' &amp;/ \ # : @</TD>
<TD> ! " # % &amp; ' ( ) * + , - . / : ; &lt; = > ? [ \ ] _ {} 〜¬ |</TD>
</TR>
</TABLE>

<P>上記文字セットをみて解るように、RPGの文字セットの中には、日本語５２５０端末で表示や打鍵ができない文字は、ほとんど含まれていないことが分かると思います。
<P>Ｃ言語の必要とする文字セットはどうでしょう。こちらの文字セットの特殊文字には、エミュレータによっては打鍵できない文字がずいぶんと含まれています。
<BR>打鍵可能な特殊文字は、エミュレータの種類やキーボードタイプにより多少異なります。（5250PC，5250WS，CM/2,PCOMなど)
<P>キーボートから打鍵できない文字が必要になった場合のために、Ｃ言語では、３文字表記と言う方法にて特殊文字を記述することが可能となっています。<BR>
<B>これは、打鍵可能な文字を３文字組み合わせて、１つの特殊文字を表す方法です。</B>これは、プラットフォームに関係なく、Ｃ言語の標準として定義されています。

<P>主な３文字表記

<TABLE BORDER=1 ALINE="CENTER" CELLSPACING=0 CELLPADDING=10 BGCOLOR="#80FF80" >
<TR>
<TD>３文字表記</TD>
<TD>??(</TD>
<TD>??)</TD>
<TD>??&lt;</TD>
<TD>??></TD>
<TD>??/</TD>
<TD>??'</TD>
<TD>??!</TD>
<TD>??-</TD>
</TR>

<TR>
<TD>特殊文字</TD>
<TD>[</TD>
<TD>]</TD>
<TD>｛</TD>
<TD>｝</TD>
<TD>￥</TD>
<TD>＾</TD>
<TD>｜</TD>
<TD>〜</TD>
</TR>
</TABLE>

<P>エミュレーターのキーボートで特殊文字のキーがあるかないかはコーディングの効率に大きく影響しますのでできればＰＣＯＭＭなどのコードページ939をサポートするものが良いでしょう。
<P>コーディングの効率に関わることなので、３文字表記はあまりお勧めできませんが、他のプラットフォームや他のＡＳ／４００に移動したり、異なるエミュレータを使用したりするさいに起こりやすい、文字化けを避けることは可能となります。
<P>ソースコードを他のプラットフォーム（PCやUNIX）で打ち込み、ＡＳ／４００にftpなどをされるさいには、特殊文字がうまく変換できないことがありますので、その際は、３文字表記も有効かもしれません。

<P><B>ＳＥＵに関する不満</B>

ＡＳ／４００でソースコードを入力するには、ＳＥＵを使用します。これはＲＰＧと変わりありません。だだ、ＲＰＧの時は感じ無かった不便なことがＣ言語の場合はいくつかあります。多分どうしようもないのでしょうから、愚痴っぽくなってしまいますが

<P><B>ＳＥＵではタブによる段落付けが出来ません。</B>
<P>Ｃ言語は、フリーフォーマットにてソースコードを入力できます。RPGの様に決められた桁に命令コードを書く必要はありません。
そのため、Ｃ言語は、基本的な文法にさえあっていれば、どのように記述しようが自由と言うことになりますが、一般的に見やすいとされているお作法はいくつかあるようです。ちなみに〜派と言っても良いぐらいに活発な議論があるようです。私自身は動けばよいので形式にはあまりこだわりませんが、興味のある方は、関連のNEWSグループなどをご覧になるのも良いかもしれません。

<P>だだ私自身（多分みなさんも感じると思います）非常に不便と思っているのは、タブによる段落付けがＳＥＵではできないことです。ＳＥＵでは、ＴＡＢキーで文字の移動ができません。そのため、桁を揃えてソースコードを入力しようとするとスペースキーまたは矢印キーで１個づつずらさないといけません。非常に面倒です、変更も大変です。

<P><B>５２５０の画面は横８０桁か１３２桁です。</B>
<P>フリーフォーマットですし、フィールド名なども長い名前で定義できますし、
桁をずらして段落ずけなどをしていると８０桁はすぐにいっぱいになってしまいます。
ＰＣやＵｎｉｘなとの他のエディターでは、行の途中で改行キーを押すと、以降の文字は次の行になりますが、
ＳＥＵの場合は、消去されてしまいます。１３２桁も使用できますが、これはちょっと長すぎと感じながらも使用しています。

<P><B>ＳＥＵはＣ言語の文法チェックをしてくれません</B>
<P>ＲＰＧの場合はうるさいほど文法チェックしてくれるので、タイプミスなどはコンパイル前に気がつくのですが、ＳＥＵは
Ｃ言語の文法チェックを全くしません。命令コードまでチェックしろとは言いませんが、構文チェック（たとえば括弧が閉じていないとか、文の終わりに；がないとか．．）ぐらいしてくれてもよさそうなものですが全くしてくれません。
できれば、関数や引数をプロンプト表示してくれると大変助かります。

<P>ＳＥＵへの要望はつきないのですが、要はＣ言語の開発には、非常に使いにくいよって結論しかありません。文句ばかりいってもしょうがないのでこのへんでやめますが、皆さんも、ＳＥＵが使いにくいからってＣ言語の開発をやめないでくださいね。

<P><B>Ｃ言語のプログラムのコンパイル方法</B>

<P>Ｃのコンパイル命令
<UL><B>
<LI>ＣＲＴＢＮＤＣ.........ソースコードからプログラムを作成
<LI>ＣＲＴＣＭＯＤ.........ソースコードからモジュールを作成
<LI>ＣＲＴＰＧＭ...........モジュールからプログラムを作成
<LI>ＣＲＴＳＲＶＰＧＭ.....モジュールからサービスプログラムを作成
</UL></B>

<P>ＩＬＥ環境では、ＰＧＭはまずモジュールとしてコンパイルし、モジュールをＢＩＮＤして（ｌｉｎｋていう方が一般的ですが）ＰＧＭとします。

<P>ＰＧＭの種類としては、サービス・プログラムとプログラムの2種類があります。

<P>プログラムはＲＰＧと同じくＣＡＬＬ命令によって呼び出されるＰＧＭです。

<P>サービス・プログラムとは、プログラムから呼び出される外部関数をサービスする汎用ルーチンのかたまりとして利用できます。（windowsのDLLだと思ってください）そのため直接CALLで実行はできません。

<P>詳しくは別の章で説明したいと思いますので、いまは、この程度にしておきます。

<P><B><FONT COLOR="#FF00FF">プログラム作成時の注意事項</FONT></B>

<P><B>CRTBNDC/CRTCMODはデフォルトでは、コンパイルリストを作成しません。</B>
<BR>エラーの内容を確認するためコンパイルリストを出力したいときは、コンパイルオプションで*PRINTを指定する必要があります。
<P>また、デフォルトでは、デバッグ用のコードも生成しません。開発中などはDEBUGオプションを*ALLにしてコンパイルしておく方がよいでしょう。

<P>コンパイルのつどパラメーターをセットするのは面倒なので、コマンドの省略値をCHGCMDDFTで変更する方法もありますが、他の人の迷惑にならないように、気をつけましょう。

<P>PDMのユーザーオプションに自分用のオプションを追加する方法もあります。
<FONT SIZE=-1>たとえば、以下のようにできます</FONT><P>
<BR><FONT SIZE=-1>ＭＫ　ＣＲＴＢＮＤＣ　＊ＰＲＩＮＴ　ＤＥＢＵＧ（＊ＡＬＬ）</FONT>
<BR><FONT SIZE=-1>ＭＭ　ＣＲＴＣＭＯＤ　＊ＰＲＩＮＴ　ＤＥＢＵＧ（＊ＡＬＬ）</FONT>

<P><B>ソースファイルはCCSID(65535)で作成してください。</B>

<P>多分コンパイラーのトラブルだと思われますが、漢字（ＤＢＣＳ）文字がソースコードに含まれているとコンパイルエラーになります。（コメントなど関係ないところでもエラーになります）これを避けるには、ソースファイル作成時にCRTSRCPF...CCSID(65535)として作成してください。

<P><B>必要なＯＳ／４００ライセンスプログラム</B>

<UL>
<LI>C言語のコンパイラー
<BR><B>5xxx-CX2　ILE C AS/400 用</B><P>

<LI>ソースファイル編集用
<BR><B>5xxx-PW1　適用業務開発ツールセット AS/400 用</B><P>

<LI>socketなどプログラムの作成を行う場合
<BR><B>5xxx-SS1  オプション13 OS/400-システム・オープンの組込み</B><P>

<LI>thread プログラムを作成／実行する場合
<BR><B>5xxx-SS1  オプション15 OS/400-ＣＰＡツールキット</B><P>
</UL>


</FONT>
</TD></TR>
</TABLE>

<P><HR>

</TD></TR>
</TABLE>

</body>
</html>