<HTML>
<HEAD>
<TITLE>CLab_05-Ｆ仕様書</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

<CENTER>
<TABLE BORDER=0" WIDTH="600" BGCOLOR="#FEFBDA">
<TR><TD>

<TABLE BORDER=0" WIDTH="600">
<TR>
<TD BGCOLOR="#800040" WIDTH="10%" ALIGN="CENTER">
<FONT SIZE=2 COLOR="#FFFFFF"><B>第５章</B></FONT>
</TD>

<TD BGCOLOR="000000" WIDTH="75%">
<FONT SIZE=4 COLOR ="#FFFFFF"><B>　ＰＲＴＦも使えるの？</B></FONT>
<BR>
</TD>
<TD BGCOLOR="000000" WIDTH="15%">
<FONT SIZE=1 COLOR ="#FFFFFF"><B>
RPGプログラマーの為のＣ言語講座
</B></FONT>
</TD>
</TR>
</TABLE>
</TD></TR>
<TR><TD ALIGN="CENTER">
<TABLE BORDER=0" WIDTH="570">
<TR>
<TD><FONT SIZE=2>

<P>ＰＲＴＦを使用して、印刷スプールを作ってみましょう。

<P>
<CENTER>
<TABLE BORDER=1 WIDTH="550" BGCOLOR="#E0FFDF" >
<TR>
<TD>
<FONT SIZE=2>
<PRE>
     H            Y/                                    1
     <FONT COLOR="#008000">H*------------------------------------------------------------*
     H* PROGRAM-ID    :    PRT1R                                   *
     H* REMARKS       :   印刷のプログラム
     H* AUTHOR        :    Y.IDE                                   *
     H* DATE-WRITEN   :    98/09/23                                *
     H* VERSION       :    01.00 ORIGINAL                          *
     H*------------------------------------------------------------*</FONT>
     FQPRINT  O   F     132     OF     PRINTER
     C*
     C                     MOVE *ALL'='   LINE   50
     <FONT COLOR="#008000">C*印刷出力</FONT>
     C                     EXCPTP#HDR
     C           1         DO   5         X       30
     C                     EXCPTP#DTL
     C                     ENDDO
     C*
     C                     SETON                     LR
     C                     RETRN
     OQPRINT  E   0305         P#HDR
     O                                   45 'ＣＬＡＢサンプル'
     O                         UDATE Y   70
     OQPRINT  E  2             P#DTL
     O                         X         10
     O                                   14 '行'
     O                         LINE    +001
</PRE>
</FONT>
</TD>
</TR>
</TABLE>
</CENTER>

<P><B>[プログラムの解説］</B><UL>
    内部記述でＰＲＴＦを定義してあります。ＥＸＣＰＴ命令で、まずヘッダーを出力してから、<BR>
１行から５行のラインを出力してプログラム終了します。

</UL>

<P>出力結果は以下のようになります
<P>
<CENTER>
<TABLE BORDER=1 WIDTH="550" BGCOLOR="#E0FFDF" >
<TR>
<TD>
<FONT SIZE=2>
<PRE>
                           スプール・ファイルの表示                          
 ファイル . . . :   QPRINT                           ページ／行  1/3         
 制御 . . . . . .                                    桁          1 - 75      
 検索 . . . . . .                                                            
 *...+....1....+....2....+....3....+....4....+....5....+....6....+....7....+ 
                             ＣＬＡＢサンプル                  98/09/23      
 001 行  ==================================================           
 002 行  ==================================================           
 003 行  ==================================================           
 004 行  ==================================================           
 005 行  ==================================================           
</PRE>
</FONT>
</TD>
</TR>
</TABLE>
</CENTER>

<B><P>Ｃ言語で書き直してみましょう!</B>
<P>
<CENTER>
<TABLE BORDER=1 WIDTH="550" BGCOLOR="#E0FFDF" >
<TR>
<TD>
<FONT SIZE=2>
<PRE>
<FONT COLOR="#008000">/*---------------------------------------------------------------*/
/* PROGRAM-ID  : PRT1C                                           */
/* REMARKS     : 印刷PGM                                       */
/* AUTHOR      : Y.Ide                                           */
/* DATE-WRITEN : 98/09/23                                        */
/* VERSION     : 01.00 ORIGINAL                                  */
/*---------------------------------------------------------------*/
</FONT>
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;recio.h&gt;
#include &lt;errno.h&gt;

_RIOFB_T                     *rfb;

<FONT COLOR="#008000">/*----------------------------------------*/</FONT>
 void main(){
<FONT COLOR="#008000">/*----------------------------------------*/</FONT>
  char outbuf[99999];
  char line[51];
  _RFILE  *fp;
  size_t  size = 133;
  int i;

  memset(line,'=',50);

<FONT COLOR="#008000"> /* PRINT File Open */</FONT>
  if ((fp = <FONT COLOR="#FF0000">_Ropen("QPRINT","wr riofb=N lrecl=132")</FONT>) == NULL)
  {
    printf("OPEN FAILED\n");
    exit(1);
  }

  memset(outbuf,' ',132);
  memcpy(&outbuf[29],"ＣＬＡＢサンプル",18);

  rfb =  <FONT COLOR="#FF0000">_Rwrite</FONT>( fp, outbuf, size);

  for (i=1;i<=5;i++){
    memset(outbuf,' ',132);
    sprintf(outbuf,"      %d行%s",i,line);
    rfb =  <FONT COLOR="#FF0000">_Rwrite</FONT>( fp, outbuf, size);
  }

   <FONT COLOR="#FF0000">_Rclose</FONT>(fp);

}
</PRE>
</FONT>
</TD>
</TR>
</TABLE>
</CENTER>

<P><B>[プログラムの解説］</B><UL>
    ＲＰＧでは、出力仕様書に行スキップがありましたが、Ｃでは、行間隔はＰＧＭでコントロールが必要です。
    <P>日付／ページなども、ＲＰＧでは予約語／編集語などがあり、簡単に日付印刷などが可能ですが、Ｃでは、
    それらもプログラムで行う必要があります。（多くのサービス関数が提供されているので利用可能です）
    <P>上記Ｃプログラムは、細かい位置合わせ，日付の表示、数値編集などについては省略しています。<BR>
    もし、気が向いた方は､ご自分で追加してみてください。
</UL>

</FONT>
</TD></TR>
</TABLE>

<HR>
</TD></TR>
</TABLE>

</BODY>
</HTML>
